<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Linux top命令学习 - Wallis</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="bomir" />
  <meta name="description" content="之前的学习过程中， 对Linux的top命令老是一知半解，然后也不能很清楚的知道各项参数的含义，特地去学习一下然后记录； Top命令 我们平时会部" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.104.0" />


<link rel="canonical" href="https://bomir.top/post/top-command-learn/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Linux top命令学习" />
<meta property="og:description" content="之前的学习过程中， 对Linux的top命令老是一知半解，然后也不能很清楚的知道各项参数的含义，特地去学习一下然后记录； Top命令 我们平时会部" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bomir.top/post/top-command-learn/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-11-15T22:19:05+00:00" />
<meta property="article:modified_time" content="2020-11-15T22:19:05+00:00" />

<meta itemprop="name" content="Linux top命令学习">
<meta itemprop="description" content="之前的学习过程中， 对Linux的top命令老是一知半解，然后也不能很清楚的知道各项参数的含义，特地去学习一下然后记录； Top命令 我们平时会部"><meta itemprop="datePublished" content="2020-11-15T22:19:05+00:00" />
<meta itemprop="dateModified" content="2020-11-15T22:19:05+00:00" />
<meta itemprop="wordCount" content="2361">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux top命令学习"/>
<meta name="twitter:description" content="之前的学习过程中， 对Linux的top命令老是一知半解，然后也不能很清楚的知道各项参数的含义，特地去学习一下然后记录； Top命令 我们平时会部"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">秤流沙</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      秤流沙
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bomir.top/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/Bicomir" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Linux top命令学习</h1>
      
      <div class="post-meta">
        <time datetime="2020-11-15" class="post-time">
          2020-11-15
        </time>
        <div class="post-category">
            <a href="https://bomir.top/categories/linux/"> Linux </a>
            
          </div>
        <span class="more-meta"> 约 2361 字 </span>
          <span class="more-meta"> 预计阅读 5 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#基本参数含义">基本参数含义</a>
      <ul>
        <li><a href="#字段说明">字段说明</a></li>
        <li><a href="#实际操作">实际操作</a></li>
      </ul>
    </li>
    <li><a href="#常用快捷键操作">常用快捷键操作</a></li>
    <li><a href="#排序字段">排序字段</a></li>
    <li><a href="#问题排查模拟">问题排查模拟</a></li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>之前的学习过程中， 对Linux的top命令老是一知半解，然后也不能很清楚的知道各项参数的含义，特地去学习一下然后记录；</p>
<h1 id="top命令">Top命令</h1>
<p>我们平时会部署一些应用到Linux服务器，所以经常需要了解服务器的运行状态，<code>top</code>命令就是帮助我们了解服务器当前状态的非常实用的工具。</p>
<p>你可以全面了解当前CPU、内存、进程等一系列当前服务器状态。</p>
<p>在linux终端中，输入<code>top</code> 按下<code>Enter</code>，立即进入<code>top</code>界面。</p>
<p><img src="https://bomir.top/pics/commandimages/1628136486740.png" alt="1628136486740"></p>
<p>让我们来分析一下，上面显示的内容代表什么意义，以及各块的内容的含义。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">top - 12:03:11 up  1:49,  <span class="m">2</span> users,  load average: 0.00, 0.00, 0.00
</span></span><span class="line"><span class="cl">Tasks: <span class="m">319</span> total,   <span class="m">1</span> running, <span class="m">221</span> sleeping,   <span class="m">0</span> stopped,   <span class="m">0</span> zombie
</span></span><span class="line"><span class="cl">top - 12:12:05 up  1:58,  <span class="m">2</span> users,  load average: 0.00, 0.00, 0.00
</span></span><span class="line"><span class="cl">Tasks: <span class="m">317</span> total,   <span class="m">1</span> running, <span class="m">221</span> sleeping,   <span class="m">0</span> stopped,   <span class="m">0</span> zombie
</span></span><span class="line"><span class="cl">%Cpu<span class="o">(</span>s<span class="o">)</span>:  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span></span><span class="line"><span class="cl">KiB Mem :  <span class="m">4292528</span> total,  <span class="m">1665160</span> free,  <span class="m">1373796</span> used,  <span class="m">1253572</span> buff/cache
</span></span><span class="line"><span class="cl">KiB Swap:  <span class="m">3999740</span> total,  <span class="m">3999740</span> free,        <span class="m">0</span> used.  <span class="m">2632412</span> avail Mem 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                 
</span></span><span class="line"><span class="cl">    <span class="m">11</span> root      <span class="m">20</span>   <span class="m">0</span>       <span class="m">0</span>      <span class="m">0</span>      <span class="m">0</span> I   0.3  0.0   0:10.95 rcu_sched                                             
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="基本参数含义">基本参数含义</h2>
<h3 id="字段说明">字段说明</h3>
<p><strong>第一行：  基本信息</strong></p>
<p><img src="https://bomir.top/pics/commandimages/498039608.png" alt=""></p>
<p><strong>第二行：任务信息</strong></p>
<p><img src="https://bomir.top/pics/commandimages/1093500469.png" alt=""></p>
<p><strong>第三行： CPU使用情况</strong></p>
<p><img src="https://bomir.top/pics/commandimages/3-373575234.png" alt=""></p>
<p><strong>第四行： 物理内存使用情况</strong></p>
<p><img src="https://bomir.top/pics/commandimages/4-746186057.png" alt=""></p>
<p><strong>buff/cache：</strong></p>
<p>buffers 和 cache 都是内存中存放的数据，不同的是，buffers 存放的是准备写入磁盘的数据，而 cache 存放的是从磁盘中读取的数据</p>
<p>在Linux系统中，有一个守护进程(daemon)会定期把buffers中的数据写入的磁盘，也可以使用 sync 命令手动把buffers中的数据写入磁盘。使用buffers可以把分散的 I/O 操作集中起来，减少了磁盘寻道的时间和磁盘碎片。 
cache是Linux把读取频率高的数据，放到内存中，减少I/O。Linux中cache没有固定大小，根据使用情况自动增加或删除。</p>
<p><strong>第五行：交换区使用情况</strong></p>
<p><img src="https://bomir.top/pics/commandimages/5-207076304.png" alt=""></p>
<p><strong>Swap(内存交换区)：</strong></p>
<p>是硬盘上的一块空间。在内存不足的情况下，操作系统把内存中不用的数据存到硬盘的交换区，腾出内存来让别的程序运行。因此，开启swap会一定程度的引起 I/O 性能下降(阿里服务器默认不开)。</p>
<p><strong>第六行： 进程详细信息</strong></p>
<p><img src="https://bomir.top/pics/commandimages/6-987952469.png" alt=""></p>
<h3 id="实际操作">实际操作</h3>
<p>首行：系统的整体情况概览</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">名称            系统运行3时:46分            系统负载：1分钟/5分钟/15分钟级
</span></span><span class="line"><span class="cl">top - 19:25:37 up  3:46,  <span class="m">2</span> users,  load average: 0.00, 0.05, 0.10
</span></span><span class="line"><span class="cl">     系统当前时间         当前登录用户数2人       对于单核CPU 1.0表示满负载
</span></span></code></pre></td></tr></table>
</div>
</div><p>第2行：进程状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">进程总任务数：97个     运行进程1个  96个当前睡眠状态  停止进程0个    僵尸进程0个
</span></span><span class="line"><span class="cl">Tasks:  <span class="m">97</span> total,   <span class="m">1</span> running,  <span class="m">96</span> sleeping,   <span class="m">0</span> stopped,   <span class="m">0</span> zombie
</span></span></code></pre></td></tr></table>
</div>
</div><p>第3行：CPU状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Cpu占用比： 用户空间  内核空间  用户定义优先级  空闲   等待IO   硬中断    软中断     虚拟机
</span></span><span class="line"><span class="cl">%Cpu<span class="o">(</span>s<span class="o">)</span>:  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span></span></code></pre></td></tr></table>
</div>
</div><p>第3-4行： 内存和Swap交换区状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">单位 物理内存         总量            空闲           已使用           内核缓存用量
</span></span><span class="line"><span class="cl">KiB Mem :  <span class="m">1014720</span> total,   <span class="m">207632</span> free,   <span class="m">313624</span> used,   <span class="m">493464</span> buff/cache
</span></span><span class="line"><span class="cl">    交换区           总量            空闲           已使用              可用内存
</span></span><span class="line"><span class="cl">KiB Swap:  <span class="m">4095996</span> total,  <span class="m">3379452</span> free,   <span class="m">716544</span> used.   <span class="m">534020</span> avail Mem
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后需要了解的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">进程ID      优先级 Nice值 虚拟内存 物理内存 共享内存 CPU  内存    CPU总时间 命令
</span></span><span class="line"><span class="cl">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
</span></span><span class="line"><span class="cl"> <span class="m">3548</span> mysql     <span class="m">20</span>   <span class="m">0</span>  <span class="m">985096</span>   <span class="m">5548</span>   <span class="m">1560</span> S  0.3  0.5   0:06.74 mysql
</span></span><span class="line"><span class="cl">                                          进程状态
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>NI 负值表示高优先级，正值表示低优先级</p>
</blockquote>
<h2 id="常用快捷键操作">常用快捷键操作</h2>
<ul>
<li><code>shift+e</code> 切换内存显示模式（可重复按键切换）</li>
<li><code>z</code> 切换是否彩色显示（可重复按键切换）</li>
<li><code>m</code> 切换内存显示模式（可重复按键切换）</li>
<li><code>e</code> 切换底部进程中单位的显示模式（可重复按键切换）</li>
<li><code>b</code> 切换高亮选中（可重复按键切换）</li>
<li><code>W</code> 把当前配置保存到文件中，下次启动top会使用当前的配置</li>
<li><code>h</code> 进入帮助菜单 (进入菜单后，可按ESC或q退出帮助菜单)</li>
<li><code>q</code> 退出<code>top</code>命令</li>
</ul>
<p><img src="https://bomir.top/pics/commandimages/1628136959977.png" alt="1628136959977"></p>
<h2 id="排序字段">排序字段</h2>
<p>底部的进程排序，是可以选择按指定列进行排序的。</p>
<ul>
<li>先按<code>f</code>进入字段选择界面，</li>
<li>然后按<code>上下键</code>选择要排序的字段，界面会高亮显示，选中合适的内容</li>
<li>确定选中操作后，按下<code>s</code>键，激活这个选择。</li>
<li>最后按<code>q</code>键退出排序字段选择界面。</li>
</ul>
<p><img src="https://bomir.top/pics/commandimages/1628137080774.png" alt="1628137080774"></p>
<p>你会看到不同的排序界面</p>
<p><img src="https://bomir.top/pics/commandimages/1628137234657.png" alt="1628137234657"></p>
<h2 id="问题排查模拟">问题排查模拟</h2>
<p>一般，排查问题会用到的top参数， 比如说出现死循环或者死锁了；</p>
<p>先介绍一下使用到的top参数；</p>
<p><img src="https://bomir.top/pics/commandimages/top-949128163.png" alt=""></p>
<p><code>top -p 2624 -H</code></p>
<p><img src="https://bomir.top/pics/commandimages/1628138166262.png" alt="1628138166262"></p>
<p><strong>排查问题的思路</strong></p>
<blockquote>
<p>**Review代码。**首先想，是否是本身的代码有问题，将代码发给有压测经验的同事帮忙review，并本身对代码review。同事依据经验判断，4核8G的机器不该该会这么慢。</p>
<p>**CPU占用率较高。**因为本身代码中用户ID在首次请求到接口会走一个INSERT或UPDATE分支不然只走查询分支，INSERT或UPDATE分支都有生成惟一键的需求，这部分参考了美团的leaf分布式ID生成算法，即号段思想，获取一个号段后，在本地利用 <em>AtomicLong</em> 进行自增（我把获取号段这部分由数据库改为了redis，并简化了算法，只参照了思路）。<em>AtomicLong</em> 底层是采用CAS的，也就是在并发状况下会进行自旋，致使CPU资源的占用。</p>
<p>**验证CPU占用率的猜测。**将生成惟一Key的方法替换为redis自增。让测试从新再次压测，并无太多变化，排除该问题。</p>
<p>**接口请求速度过慢。**没什么思路，请教了技术经理。技术经理review代码后，以为多是插入和更新等操做影响了，建议给测试一些只会走查询分支的再看看，因而导出一份只走查询分支的数据，让测试从新压测，TPS仍是在180左右，且CPU占用率仍是十分异常，且测试说以前压测的数据库没什么压力，应该不是这个问题。</p>
<p>**排查具体哪一部分调用占时太高。**技术经理建议将代码中调用到ms层(即数据库层到返回到接口层)的部分，都打上调用时间日志，并在ms层底层也打上调用时间日志。打印日志后，再次进行压测，排查日志，发现ms查询数据库只须要3ms，可是从请求ms层到返回接口层耗时高达100+ms，怀疑是平台组框架问题。因而尝试单压接口层check接口，即无逻辑接口，请求后调用ms层check直接返回。本身尝试单压了下check接口，结果tps在280+，技术经理表示这种接口至少得有几千以上的TPS，多是平台组框架问题。可是组长表示以前到这次压测并无升级过平台组框架。</p>
</blockquote>
<p>类似的，找到CPU占用高的pid;</p>
<p>查看该pid的进程中线程的具体情况， 利用命令工具获取进程的详细堆栈信息， 通过堆栈信息定位到代码中出问题的位置；</p>
<h2 id="参考资料">参考资料</h2>
<p><a href="https://blog.csdn.net/cdw_sunshine/article/details/84024731">https://blog.csdn.net/cdw_sunshine/article/details/84024731</a></p>
<p><a href="https://www.shangmayuan.com/a/8c6412dfba4f4ff8827d62f3.html">https://www.shangmayuan.com/a/8c6412dfba4f4ff8827d62f3.html</a></p>
<p><a href="https://www.cnblogs.com/zjfjava/p/10448002.html">https://www.cnblogs.com/zjfjava/p/10448002.html</a></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">bomir</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2020-11-15
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bomir.top/tags/linux/">linux</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/redis-interview-1/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">redis面试连环炮I</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/message-queue-record/">
            <span class="next-text nav-default">消息队列记录</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Shaper-fox/hugoblogtalks"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:jinchunw@385@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/Bicomir" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://bomir.top/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>
  <span class="copyright-year">
    &copy;
    
      2017 -
    2022
    <span class="heart">
      
      <i class="iconfont">        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        bomir
        
      </span>
	  <span class="division">|</span>
	  <span class="author">
			<a href="http://beian.miit.gov.cn/">粤ICP备2021140392号-1</a>
	  </span></span>
  
  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
